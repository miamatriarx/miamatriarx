---
name: Release
concurrency:
  group: ${{github.workflow}}-${{github.ref}}
  cancel-in-progress: true
on:
  push:
    tags: '*'
  workflow_dispatch:
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Mock
        run: echo "Released"
  #   permissions:
  #     contents: read
  #     packages: write
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #       with:
  #         fetch-depth: 0
  #     - name: Auth
  #       uses: docker/login-action@v2
  #       with:
  #         registry: ${{env.REGISTRY}}
  #         username: ${{github.actor}}
  #     - name: Metadata
  #       id: meta
  #       uses: docker/metadata-action@v4
  #       with:
  #         images: ${{env.REGISTRY}}/${{env.IMAGE_NAME}}
  #     - name: Build & Push
  #       uses: docker/build-push-action@v3
  #       with:
  #         context: .
  #         push: true
  #         tags: ${{steps.meta.outputs.tags}}
  #         labels: ${{steps.meta.outputs.labels}}
  # deploy:
  #   needs:
  #     - build
  #   name: Deploy
  #   runs-on: ubuntu-latest
  #   permissions:
  #     contents: read
  #     id-token: write
  #   env:
  #     PROJECT_ID: PROJECT_ID
  #     GAR_LOCATION: GAR_LOCATION
  #     SERVICE: SERVICE_NAME
  #     REGION: SERVICE_REGION
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #     - name: Auth
  #       id: auth
  #       uses: google-github-actions/auth@v0
  #       with:
  #         token_format: access_token
  #         workload_identity_provider: ${{secrets.WIF_PROVIDER}}
  #         service_account: ${{secrets.WIF_SERVICE_ACCOUNT}}
  #     - name: Docker Auth
  #       id: docker-auth
  #       uses: docker/login-action@v1
  #       with:
  #         username: oauth2accesstoken
  #         password: ${{steps.auth.outputs.access_token}}
  #         registry: ${{env.GAR_LOCATION}}-docker.pkg.dev
  #     - name: Build
  #       run: |
  #         docker build -t "${{env.GAR_LOCATION}}-docker.pkg.dev/${{env.PROJECT_ID}}/${{env.SERVICE}}:${{github.sha}}" .
  #         docker push "${{env.GAR_LOCATION}}-docker.pkg.dev/${{env.PROJECT_ID}}/${{env.SERVICE}}:${{github.sha}}"
  #     - name: Deploy
  #       id: deploy
  #       uses: google-github-actions/deploy-cloudrun@v0
  #       with:
  #         service: ${{env.SERVICE}}
  #         region: ${{env.REGION}}
  #         image: ${{env.GAR_LOCATION}}-docker.pkg.dev/${{env.PROJECT_ID}}/${{env.SERVICE}}:${{github.sha}}
  #     - name: Finalize
  #       run: echo ${{steps.deploy.outputs.url}}
